<!DOCTYPE html>
<html>

<head>
    <title>Nail-Biting Feedback</title>
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="manifest" href="img/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/sankey.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link href="index.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'>
    <style>
        body {
            font-family: 'Open Sans';
        }
    </style>
</head>

<body>
    <figure class="highcharts-figure">
        <div id="container"></div>
        <h3>Hover over the relevant links to view feedback tailored to your needs. You can <strong>click or unclick
                multiple nodes</strong> based on your specific cases.</h3>
        <div>
            <h3> 1. Can you <u>self-control</u> your nail-biting?</h3>
        </div>
        <div>
            <h3>2. Do you want feedback related to physical intervention (e.g., installing an object to hide nails)?
            </h3>
        </div>
        <div>
            <h3>3.1 Do you want the feedback increase the awareness?</h3>
        </div>
        <div>
            <h3>3.2 Do you want the feedback can be a distraction?</h3>
        </div>
        <div>
            <h3>3.3 Do you want strong feedback or mild feedback?</h3>
        </div>
    </figure>
    <script>

        // Store original colors
        const originalColors = {};
        var feedbackScores = {
            Vibration: 0,
            Balloon: 0,
            Band: 0,
            Actuation: 0,
            Tingling: 0
        };
        const chart = Highcharts.chart('container', {
            chart: {
                marginRight: 45, // allows the yAxis labels with (x: 30) to be seen, but reduces navigator size
            },
            plotOptions: {
                series: {
                    states: {
                        inactive: {
                            opacity: 1
                        }
                    }
                }
            },
            title: {
                text: 'Feedback Suggestion for Suppressing Nail-Biting'
            },

            subtitle: {
                text: 'Understanding Traits of Individuals with Nail-Biting to Explore the Design Space for Multimodal Behavior Feedback'
            },
            accessibility: {
                point: {
                    valueDescriptionFormat: '{index}. {point.from} &#10132; {point.to}, {point.weight}.'
                }
            },
            tooltip: {
                headerFormat: null,
                pointFormat:
                    '{point.from} &#10132; {point.to}',
                nodeFormat: '{point.name}'
            },
            series: [{
                keys: ['from', 'to', 'weight', 'color', 'states'],
                nodes: [
                    {
                        id: 'Yes',
                        color: '#A6CF98',
                    },
                    {
                        id: 'No',
                        color: '#FF6969'
                    },
                    {
                        id: 'Self-control',
                        color: '#f5f7fa'
                    },
                    {
                        id: 'Physical intervention',
                        color: '#f5f7fa' // Another Orange color
                    },
                    {
                        id: 'Awareness',
                        color: '#f5f7fa' // Blue color
                    },
                    {
                        id: 'Distraction',
                        color: '#f5f7fa',
                    },
                    {
                        id: 'Punishiment',
                        color: '#99f7fa',
                    },
                    {
                        id: 'Want Strong Feedback',
                        color: '#f5f7fa',
                    },
                    {
                        id: 'EMS Tingling Sensation',
                        color: '#073b4c',
                    },
                    {
                        id: 'Pneumatic Finger Band',
                        color: '#06d6a0',
                    },
                    {
                        id: 'Vibration',
                        color: '#ef476f',
                    }
                    , {
                        id: 'Pneumatic Balloon',
                        color: '#ffd166',
                    },
                    {
                        id: 'EMS Actuation',
                        color: '#118ab2',
                    }
                ],
                data: [
                    {
                        id: 'core',
                        from: 'Self-control',
                        to: 'Yes',
                        weight: 30,
                        color: '#ed5565',
                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Vibration1', 'Band1', 'Balloon1'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Vibration1', 'Band1', 'Balloon1'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                //points update: if toggled --> --, if not toggled --> ++          
                                //update score again
                                // feedbackScores.vibration++;
                                // feedbackScores.balloon++;
                                //toogleColors if the points are same and if the points are different, toggle 1 lines. 
                                const targetId = 'core';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#ed5565") {
                                    feedbackScores.Vibration--;  // Decrement if color is blue
                                    feedbackScores.Balloon--;  // Decrement if color is blue
                                    feedbackScores.Band--;  // Decrement if color is blue

                                } else {
                                    feedbackScores.Vibration++;  // Decrement if color is blue
                                    feedbackScores.Balloon++;  // Decrement if color is blue
                                    feedbackScores.Band++;  // Increment if color is not blue
                                }
                                toggleColors(['core', 'Vibration1', 'Band1', 'Balloon1'])
                            },
                        },

                    },
                    {
                        id: 'Vibration1',
                        from: 'Yes',
                        to: 'Vibration',
                        weight: 10,
                        color: '#ed5565',
                    },
                    {
                        id: 'Balloon1',
                        from: 'Yes',
                        to: 'Pneumatic Balloon',
                        weight: 10,
                        color: '#ed5565',

                    },
                    {
                        id: 'Band1',
                        from: 'Yes',
                        to: 'Pneumatic Finger Band',
                        weight: 10,
                        color: '#ed5565',
                    },

                    ////////////
                    {
                        id: 'core2',
                        from: 'Self-control',
                        to: 'No',
                        weight: 30,
                        color: '#ffce54',
                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Band2', 'Actuation1', 'Tingling1'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Band2', 'Actuation1', 'Tingling1'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core2';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#ffce54") {
                                    feedbackScores.Actuation--;  // Decrement if color is blue
                                    feedbackScores.Tingling--;  // Decrement if color is blue
                                    feedbackScores.Band--;  // Decrement if color is blue

                                } else {
                                    feedbackScores.Actuation++;  // Decrement if color is blue
                                    feedbackScores.Tingling++;  // Decrement if color is blue
                                    feedbackScores.Band++;  // Decrement if color is blue
                                }
                                toggleColors(['core2', 'Band2', 'Actuation1', 'Tingling1'])

                            },
                        },
                    },
                    {
                        id: 'Band2',
                        from: 'No',
                        to: 'Pneumatic Finger Band',
                        weight: 10,
                        color: '#ffce54',
                    },

                    {
                        id: 'Actuation1',
                        from: 'No',
                        to: 'EMS Actuation',
                        weight: 10,
                        color: '#ffce54',

                    },

                    {
                        id: 'Tingling1',
                        from: 'No',
                        to: 'EMS Tingling Sensation',
                        weight: 10,
                        color: '#ffce54',
                    },
                    //////////
                    {
                        id: 'core3',
                        from: 'Physical intervention',
                        to: 'Yes',
                        weight: 20,
                        color: '#48cfad',
                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Band3', 'Actuation2'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Band3', 'Actuation2'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },

                            click: function () {

                                const targetId = 'core3';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#48cfad") {
                                    feedbackScores.Actuation--;  // Decrement if color is blue
                                    feedbackScores.Band--;  // Decrement if color is blue

                                } else {
                                    feedbackScores.Actuation++;  // Decrement if color is blue
                                    feedbackScores.Band++;  // Decrement if color is blue
                                }
                                //toggleColors(['core2', 'Band2', 'Actuation1', 'Tingling1'])
                                toggleColors(['core3', 'Band3', 'Actuation2'])
                            },
                        },
                    },
                    {
                        id: 'Band3',
                        from: 'Yes',
                        to: 'Pneumatic Finger Band',
                        weight: 10,
                        color: '#48cfad',
                    },
                    {
                        id: 'Actuation2',
                        from: 'Yes',
                        to: 'EMS Actuation',
                        weight: 10,
                        color: '#48cfad',
                    },
                    ////
                    ////////////
                    {
                        id: 'core4',
                        from: 'Physical intervention',
                        to: 'No',
                        weight: 30,
                        color: '#5d9cec',
                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = [ 'Vibration2', 'Balloon2', 'Tingling2'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = [ 'Vibration2', 'Balloon2', 'Tingling2'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core4';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#5d9cec") {
                                    feedbackScores.Vibration--  // Decrement if color is blue
                                    feedbackScores.Balloon--  // Decrement if color is blue
                                    feedbackScores.Tingling--  // Decrement if color is blue
                                } else {
                                    feedbackScores.Vibration++;  // Decrement if color is blue
                                    feedbackScores.Balloon++;  // Decrement if color is blue
                                    feedbackScores.Tingling++;  // Decrement if color is blue
                                }
                                //toggleColors(['core2', 'Band2', 'Actuation1', 'Tingling1'])

                                toggleColors(['core4', 'Vibration2', 'Balloon2', 'Tingling2'])

                            },
                        },
                    },

                    {
                        id: 'Vibration2',
                        from: 'No',
                        to: 'Vibration',
                        weight: 10,
                        color: '#5d9cec',
                    },

                    {
                        id: 'Balloon2',
                        from: 'No',
                        to: 'Pneumatic Balloon',
                        weight: 10,
                        color: '#5d9cec',

                    },

                    {
                        id: 'Tingling2',
                        from: 'No',
                        to: 'EMS Tingling Sensation',
                        weight: 10,
                        color: '#5d9cec',

                    },
                    ////
                    {
                        id: 'core5',
                        from: 'Awareness',
                        to: 'Yes',
                        weight: 10,
                        color: '#ec87c0',

                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Tingling3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Tingling3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core5';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#ec87c0") {
                                    feedbackScores.Tingling--  // Decrement if color is blue
                          
                                } else {
                                    feedbackScores.Tingling++;  // Decrement if color is blue
                               
                                }
                                //toggleColors(['core2', 'Band2', 'Actuation1', 'Tingling1'])

                                //toggleColors(['core4', 'Vibration2', 'Balloon2', 'Tingling2'])

                                toggleColors(['core5', 'Tingling3'])

                            },
                        },
                    },

                    {
                        id: 'Tingling3',
                        from: 'Yes',
                        to: 'EMS Tingling Sensation',
                        weight: 10,
                        color: '#ec87c0',

                    },
                    ///
                    {
                        id: 'core6',
                        from: 'Awareness',
                        to: 'No',
                        weight: 10,
                        color: '#ccd1d9',

                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Actuation3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Actuation3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core6';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#ccd1d9") {
                                    feedbackScores.Actuation--  // Decrement if color is blue
                                  
                                } else {
                                    feedbackScores.Actuation++;  // Decrement if color is blue
                        
                                }
                      
                                toggleColors(['core6', 'Actuation3'])

                            },
                        },

                    },

                    {

                        id: 'Actuation3',
                        from: 'No',
                        to: 'EMS Actuation',
                        weight: 10,
                        color: '#ccd1d9',

                    },
                    ///
                    {
                        id: 'core7',
                        from: 'Distraction',
                        to: 'Yes',
                        weight: 10,
                        color: '#F6FA70',

                        events: {
                            mouseOver: function () {
                                // Set hover state for this node
                                this.setState('hover');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and set their hover states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Balloon3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                // Reset to normal state on mouse out
                                this.setState('');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and reset their states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Balloon3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core7';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#F6FA70") {
                                    feedbackScores.Balloon--  // Decrement if color is blue
                                  
                                } else {
                                    feedbackScores.Balloon++;  // Decrement if color is blue
                        
                                }
                      
                                toggleColors(['core7', 'Balloon3'])

                            },
                        },
                    },

                    {
                        id: 'Balloon3',
                        from: 'Yes',
                        to: 'Pneumatic Balloon',
                        weight: 10,
                        color: '#F6FA70',

                    },
                    ///
                    {
                        id: 'core8',
                        from: 'Distraction',
                        to: 'No',
                        weight: 10,
                        color: '#a0d468',

                        events: {
                            mouseOver: function () {
                                // Set hover state for this node
                                this.setState('hover');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and set their hover states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Vibration3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                // Reset to normal state on mouse out
                                this.setState('');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and reset their states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Vibration3'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core8';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#a0d468") {
                                    feedbackScores.Vibration--  // Decrement if color is blue
                                  
                                } else {
                                    feedbackScores.Vibration++;  // Decrement if color is blue
                        
                                }
                      
                                toggleColors(['core8', 'Vibration3'])
                                //toggleColors(['core8', 'id23'])

                            },
                        },
                    },

                    {

                        id: 'Vibration3',
                        from: 'No',
                        to: 'Vibration',
                        weight: 10,
                        color: '#a0d468',

                    },
///
                    {
                        id: 'core9',
                        from: 'Want Strong Feedback',
                        to: 'Yes',
                        weight: 10,
                        color: '#656d78',

                        events: {
                            mouseOver: function () {
                                // Set hover state for this node
                                this.setState('hover');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and set their hover states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Actuation4'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                // Reset to normal state on mouse out
                                this.setState('');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and reset their states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Actuation4'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core9';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#656d78") {
                                    feedbackScores.Actuation--  // Decrement if color is blue
                                  
                                } else {
                                    feedbackScores.Actuation++;  // Decrement if color is blue
                        
                                }
                      
                                //toggleColors(['core8', 'Vibration3'])
                               
                                toggleColors(['core9', 'Actuation4'])

                            },
                        },
                    },

                    {

                        id: 'Actuation4',
                        from: 'Yes',
                        to: 'EMS Actuation',
                        weight: 10,
                        color: '#656d78',

                    },
                    {
                        id: 'core10',
                        from: 'Want Strong Feedback',
                        to: 'No',
                        weight: 10,
                        color: '#A633AA',

                        events: {
                            mouseOver: function () {
                                // Set hover state for this node
                                this.setState('hover');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and set their hover states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Band6'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                // Reset to normal state on mouse out
                                this.setState('');
                                // Find the related "to" nodes ('id2', 'id3', 'id4') and reset their states
                                const chart = this.series.chart;
                                const targetNodeIds = ['Band6'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function (event) {
                                const targetId = 'core10';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#A633AA") {
                                    feedbackScores.Band--  // Decrement if color is blue
                                  
                                } else {
                                    feedbackScores.Band++;  // Decrement if color is blue
                        
                                }
                      
                                toggleColors(['core10', 'Band6'])
                            }
                        },
                    },
                    {

                        id: 'Band6',
                        from: 'No',
                        to: 'Pneumatic Finger Band',
                        weight: 10,
                        color: '#A633AA',
                    },

                    {id: 'core11',
                        from: 'Punishment',
                        to: 'Yes',
                        weight: 10,
                        color: '#99f7fa',
                        
                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Tingling4'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Tingling4'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core11';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#99f7fa") {
                                    feedbackScores.Tingling--  // Decrement if color is blue
                          
                                } else {
                                    feedbackScores.Tingling++;  // Decrement if color is blue
                               
                                }
                                //toggleColors(['core2', 'Band2', 'Actuation1', 'Tingling1'])

                                //toggleColors(['core4', 'Vibration2', 'Balloon2', 'Tingling2'])

                                toggleColors(['core11', 'Tingling4'])

                            },
                        },
                    },
                    {id: 'core12',
                        from: 'Punishment',
                        to: 'No',
                        weight: 10,
                        color: '#22f7f9',
                        events: {
                            mouseOver: function () {
                                this.setState('hover');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Tingling5'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('hover');
                                    }
                                }
                                )
                            },
                            mouseOut: function () {
                                this.setState('');
                                const chart = this.series.chart;
                                const targetNodeIds = ['Tingling5'];
                                targetNodeIds.forEach(targetId => {
                                    const toNode = chart.series[0].points.find(point => point.id === targetId);
                                    if (toNode) {
                                        toNode.setState('');
                                    }
                                }
                                )
                            },
                            click: function () {
                                const targetId = 'core12';
                                const toNode = chart.series[0].points.find(point => point.id === targetId);

                                if (toNode.color !== "#22f7f9") {
                                    feedbackScores.Tingling--  // Decrement if color is blue
                          
                                } else {
                                    feedbackScores.Tingling++;  // Decrement if color is blue
                               
                                }
                                //toggleColors(['core2', 'Band2', 'Actuation1', 'Tingling1'])

                                //toggleColors(['core4', 'Vibration2', 'Balloon2', 'Tingling2'])

                                toggleColors(['core12', 'Tingling5'])

                            },
                        },
                    
                    },
                    {id: 'Tingling4',
                        from: 'Yes',
                        to: 'EMS Tingling Sensation',
                        weight: 10,
                        color: '#99f7fa',
                    },
                    {id: 'Tingling5',
                        from: 'No',
                        to: 'EMS Tingling Sensation',
                        weight: 10,
                        color: '#22f7f9',
                    },
                    

                ],
                type: 'sankey',
                name: 'Sankey demo series'
            }


            ],


        },
        );
        // Store original colors when the chart is rendered
        chart.series[0].points.forEach(point => {
            originalColors[point.id] = point.color;
        });
        chart.update({
            chart: {
                events: {
                    render: function () {
                        renderer = chart.renderer,
                            width = 30;

                        // Delete groups
                        if (chart.customImgGroup) {
                            chart.customImgGroup.destroy();
                        }

                        // Create groups
                        chart.customImgGroup = renderer.g('customImgGroup').add();

                        // Render texts
                        chart.renderer.image('img/vibration.jpg', chart.plotLeft + 30 + chart.plotSizeX - width, 67, 40, 40)
                            .add(chart.customImgGroup);

                        // Render texts
                        chart.renderer.image('img/balloon.jpg', chart.plotLeft + 30 + chart.plotSizeX - width, 120, 40, 40)
                            .add(chart.customImgGroup);
                        // Render texts
                        chart.renderer.image('img/bending.jpg', chart.plotLeft + 30 + chart.plotSizeX - width, 210, 40, 40)
                            .add(chart.customImgGroup);
                        //                 // Render texts
                        chart.renderer.image('img/actuation.jpg', chart.plotLeft + 30 + chart.plotSizeX - width, 295, 40, 40)
                            .add(chart.customImgGroup);
                        //                 // Render texts
                        chart.renderer.image('img/stimulation.jpg', chart.plotLeft + 30 + chart.plotSizeX - width, 360, 40, 40)
                            .add(chart.customImgGroup);
                    }
                }
            }
        });
        // Toggle colors on click
        //toogleColors if the points are same and if the points are different, toggle 1 lines. 

        function checkEndNodes() {
            const blueNodes = chart.series[0].points.filter(point => point.color === 'Blue');
            var topCategories = [];
            var highestScore = -Infinity;

            for (var category in feedbackScores) {
                var score = feedbackScores[category];

                if (score > highestScore) {
                    highestScore = score;
                    topCategories = [category];
                } else if (score === highestScore) {
                    topCategories.push(category);
                }
            }
            console.log("blue", blueNodes);
            console.log("topCategories2", topCategories);
            blueNodes.forEach(targetPoint => {
                const targetId = targetPoint.id;
                const toNode = chart.series[0].points.find(point => point.id === targetId);

                if (toNode) {
                    const currentColor = toNode.color;
                    const originalColor = originalColors[targetId];

                    // Check if the toNode's category is not in topCategories
                    const categoryNotInTop = !topCategories.some(category => toNode.id.includes(category) || toNode.id.includes('core'));

                    if (categoryNotInTop) {
                        console.log("Category not in topCategories:", toNode.id);
                        const currentColor = toNode.color;

                        // Perform additional actions if needed
                        if (currentColor === 'Blue') {
                            toNode.update({ color: originalColor });
                        }
                    }

                    // Rest of your code...
                }
            });
        }



        function toggleColors(nodeIds) {
            nodeIds.forEach(targetId => {

                var topCategories = [];
                var highestScore = -Infinity;

                for (var category in feedbackScores) {
                    var score = feedbackScores[category];

                    if (score > highestScore) {
                        highestScore = score;
                        topCategories = [category];
                    } else if (score === highestScore) {
                        topCategories.push(category);
                    }
                }

                // Print the result
                console.log("feedbackScores:", feedbackScores);
                console.log("Top Scored Categories:", topCategories);
                console.log("Top Score:", highestScore);
                //checkEndNodes();
                const toNode = chart.series[0].points.find(point => point.id === targetId);
                if (toNode) {
                    const currentColor = toNode.color;
                    const originalColor = originalColors[targetId];
                    topCategories.forEach(category => {

                        //if (toNode.id.includes(category) || toNode.id.includes('core')) {
                        if (currentColor === 'Blue') {
                            toNode.update({ color: originalColor });
                        } else {
                            toNode.update({ color: 'Blue' });
                        }
                        // }
                    }
                    )
                }
            });
            checkEndNodes();
            //No core selected ==> reset everything
            if (feedbackScores.Vibration == 0 && feedbackScores.Balloon == 0 && feedbackScores.Band == 0 && feedbackScores.Actuation == 0 && feedbackScores.Tingling == 0) {
                chart.series[0].points.forEach(point => {
                    point.update({ color: originalColors[point.id] });
                });
            }
        }

    </script>

</body>

</html>